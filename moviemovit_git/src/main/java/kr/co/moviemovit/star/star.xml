<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace="팩키지.인터페이스" -->
<mapper namespace="kr.co.moviemovit.star.StarMapper">

    <select id="movieList" resultType="MovieDTO" parameterType="MovieDTO">
		<![CDATA[
			SELECT mCode, poster, mName, genre, screen, age, s_e, country, director, actor, DD, runningTime, s_date, e_date
			FROM movieTable
			WHERE mCode = #{mCode}
		]]>
	</select>
	
	<!-- <select id="uidList" resultType="String" parameterType="MovieDTO">
		<![CDATA[
			SELECT uid
			FROM userTable
			ORDER BY uid DESC
		]]>
	</select> -->
	
	<insert id="create" parameterType="StarDTO">
        <selectKey keyProperty="sCode" resultType="int" order="BEFORE">
			<![CDATA[
				SELECT IFNULL(MAX(sCode),0) + 1 AS sCode
				FROM starTable
			]]>
		</selectKey>
				
		    <![CDATA[	
				INSERT INTO starTable(sCode, mCode, uid, star, comment, wdate)
				VALUES(#{sCode}, #{mCode}, #{uid}, #{star}, #{comment}, now())                        
			]]>	
	</insert>
	
	<select id="starlist" parameterType="StarDTO" resultType="StarDTO">
	    <![CDATA[
	        SELECT sCode, mCode, uid, comment, wdate, star
            FROM starTable
            WHERE mCode=#{mCode }
            ORDER BY sCode DESC
        ]]>
	</select>
	
	<select id="avgstar" resultType="int">
	    <![CDATA[
	        SELECT (select avg(star) from starTable) AS avgstar
	        FROM starTable
	        WHERE mCode=#{mCode}
	        GROUP BY mCode
	    ]]>
	</select>
	
	<!-- <select id="list" resultType="StarDTO">
	    <![CDATA[
			SELECT sCode, mCode, uid, (select avg(star) from starTable) AS star, comment, wdate
            FROM starTable
           	ORDER BY sCode DESC
		]]>
	</select> -->
	
	<!-- <select id="starlist" parameterType="Map" resultType="HashMap">
	    <![CDATA[
	        SELECT st.sCode, st.mCode, mt.mName, st.star, mt.poster
            FROM (SELECT sCode, mCode, uid, (select avg(star) from starTable) as star, comment, wdate
                  FROM starTable) st join movieTable mt
            ON mt.mCode = st.mCode
            WHERE st.mCode=#{st.mCode}
	    ]]>
	</select> -->
	
	<!-- <resultMap type="MovieDTO" id="MovieDTO">
	    <result column="mCode"  property="mCode"/>
	    <result column="mName"  property="mName"/> 
	    <result column="poster" property="poster"/>
	</resultMap> -->
	
	<!-- <resultMap type="movieDTO" id="movieDTO">
	    <result column="mCode"   property="mCode"/> 
	    <result column="poster"  property="poster"/>
	    <result column="mName"   property="mName"/> 
	    <result column="s_date"  property="s_date"/>
	    
	    <association javaType="StarDTO" property="StarDTO">
	      <id column="mCode" property="mCode"/>
          <result column="sCode"   property="sCode"/>
	      <result column="mCode"   property="mCode"/> 
	      <result column="uid"     property="uid"/> 
	      <result column="star"    property="star"/> 
	      <result column="comment" property="comment"/> 
	      <result column="wdate"   property="wdate"/> 
	    </association>
	</resultMap> -->
	
	
	
	
</mapper>





