<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.moviemovit.ticket.TicketMapper">
  <!-- ******************** 예매 목록 ******************** -->
  <select id="list" resultType="TicketDTO">
    <![CDATA[
      SELECT tCode, wdate, uid, sCode, cCode, seat, auditType
      FROM ticketTable
      ORDER BY tCode DESC
    ]]>
  </select>
  
  <!-- *********************** 예매 *********************** -->
  <!-- ********* 예매 : 영화선택 부분 ******** -->
  <!-- 영화목록 -->
  <select id="movieList" resultType="MovieDTO">
  <![CDATA[
    SELECT mCode, poster, mName, genre, screen, age, s_e, country, director, actor, DD, runningTime, s_date, e_date
    FROM movieTable
    ORDER BY mName ASC; 
  ]]>
  </select>
  <!-- ********* 예매 : 영화선택 부분 END ******** -->
  
  <!-- ********* 예매 : 극장선택 부분 ********* -->
  <!-- 극장목록 전체 -->
  <select id="cinemaList" resultType="CinemaDTO">
  <![CDATA[
    SELECT cineCode, brandName, cineName
    FROM cinemaTable
    ORDER BY brandName ASC, cineName ASC; 
  ]]>
  </select>
  
  <!-- 주소1의 극장개수 -->
  <select id="cinemacntFromAddr1" parameterType="String" resultType="int">
    SELECT COUNT(cineCode)
    FROM cinemaTable
    <where>
      <if test="addr1 != 'all'">
        addr1=#{addr1}
      </if>
    </where>
  </select>
  
  <!-- 주소1의 극장목록 -->
  <select id="cinemaListFromAddr1" parameterType="String" resultType="CinemaDTO">
  <![CDATA[
    SELECT cineCode, brandName, cineName
    FROM cinemaTable
    WHERE addr1=#{addr1}
    ORDER BY brandName ASC, cineName ASC;
  ]]>
  </select>
  
  <!-- 영화코드, 주소1 -> 극장 <ul> 목록 (mMame 에 addr1 담아옴) -->
  <select id="cinemaListFromMovieAddr1" parameterType="MovieDTO" resultType="CinemaDTO">
    <![CDATA[
      SELECT CT.cineCode,brandName,cineName
      FROM cinemaTable CT
      INNER JOIN roomTable RT
      ON CT.cineCode=RT.cineCode
      INNER JOIN screenTable ST
      ON RT.roomCode=ST.roomCode
      WHERE mCode=#{mCode}
    ]]>
      <if test="mName != 'all'">
        AND addr1=#{mName}
      </if>
    <![CDATA[
      GROUP BY CT.cineCode
      ORDER BY brandName ASC, cineName ASC
    ]]>
  </select>
  
  <!-- 영화코드, 주소1 -> 극장 목록 -->
  <select id="grayCinemaList" parameterType="int" resultType="CinemaDTO">
    <![CDATA[
      SELECT CT.cineCode,brandName,cineName
      FROM cinemaTable CT
      INNER JOIN roomTable RT
      ON CT.cineCode=RT.cineCode
      INNER JOIN screenTable ST
      ON RT.roomCode=ST.roomCode
      WHERE mCode=#{mCode}
      GROUP BY CT.cineCode
      ORDER BY brandName ASC, cineName ASC
    ]]>
  </select>
  
  
  <!-- ********* 예매 : 극장선택 부분 END ******** -->
  
  
  
  
  <!-- 영화선택 -> 상영관및시간 가져오기 -->
  <!-- <select id="screenlistFromMovie" parameterType="int" resultType="ScreenDTO">
    <![CDATA[
      SELECT sCode,roomCode,sdate,stime
      FROM screenTable
      WHERE mCode=#{mCode}
      ORDER BY sCode ASC
    ]]>
  </select> -->

  
  <!-- 예매 등록 -->
  <!-- <insert id="create" parameterType="TicketDTO">
    <selectKey keyProperty="tCode" resultType="int" order="BEFORE">
      <![CDATA[
        SELECT IFNULL(MAX(tCode),0)+1 AS cCode
        FROM ticketTable
      ]]> 
    </selectKey>
    <![CDATA[
      INSERT INTO ticketTable(tCode, uid, startDate, expDate)
      VALUES(#{tCode}, #{uid}, #{startDate}, #{expDate})
    ]]> 
  </insert> -->
  
  <!-- 예매 데이터 입력 시 회원 아이디 목록 가져오기 -->
  <!-- <select id="uidlist" resultType="String">
    <![CDATA[
      SELECT uid
      FROM ticketTable
      ORDER BY uid ASC
    ]]>
  </select> -->
  
  <!-- 예매 데이터 입력 시 검색어와 일치하는 회원 아이디 목록 가져오기 -->
  <!-- <select id="uidsearch" parameterType="String" resultType="String">
    <![CDATA[
      SELECT uid
      FROM ticketTable
      WHERE uid LIKE concat('%',#{uid},'%')
      ORDER BY uid ASC
    ]]>
  </select> -->
  
  
  <!-- 상세 데이터 읽어오기 -->
  <!-- <select id="read" parameterType="int" resultType="TicketDTO">
    <![CDATA[
      SELECT tCode, uid, startDate, expDate
      FROM ticketTable
      WHERE tCode = #{tCode}
    ]]>
  </select> -->
  
  
  <!-- 예매 수정 -->
  <!-- <update id="update" parameterType="TicketDTO">
    <![CDATA[
      UPDATE ticketTable
      SET uid=#{uid}, startDate=#{startDate}, expDate=#{expDate}
      WHERE tCode = #{tCode}
    ]]>
  </update> -->
  
  
  <!-- 예매 삭제 -->
  <!-- <delete id="delete" parameterType="int">
    <![CDATA[
      DELETE FROM ticketTable
      WHERE tCode = #{tCode}
    ]]>
  </delete> -->
  
  <!-- 영화선택 -> 영화정보 포스터 가져오기 -->
  <select id="movieData" parameterType="MovieDTO" resultType="MovieDTO">
    <![CDATA[
      SELECT mCode, poster, mName, genre, screen, age, s_e, country, director, actor, DD, runningTime, s_date, e_date
      FROM movieTable
      WHERE mCode = #{mCode}
    ]]> 
  </select>
  
</mapper>





